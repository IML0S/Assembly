# 1127 강의 내용
# 문자열 프리미티브 명령어 (String Primitive Instructions)

이 섹션에서는 어셈블리 언어에서 배열과 문자열을 효율적으로 처리하는 기본 명령어들을 설명한다.

## 레지스터 사용

32비트 모드에서 문자열 프리미티브 명령어는 메모리 주소 지정을 위해 **ESI**, **EDI** 레지스터 또는 둘 다를 암시적으로 사용한다. 누산기(accumulator)는 명령어 데이터 크기에 따라 **AL**, **AX**, **EAX**가 사용된다.

## 반복 및 효율성

문자열 프리미티브 명령어는 배열 인덱스를 자동으로 반복·증가·감소시키기 때문에 효율적으로 동작한다. 단독으로 사용될 경우 하나의 메모리 값 또는 한 쌍의 값만 처리하지만, **반복 접두사(repeat prefix)**를 추가하고 **ECX**를 카운터로 사용하면 전체 배열을 처리할 수 있다. ECX가 0보다 큰 동안 ECX가 감소하며 명령어가 반복된다.

## 명령어 기능 요약

| 명령어       | 기능     | 설명                                                                          |
| --------- | ------ | --------------------------------------------------------------------------- |
| MOVSB/W/D | 데이터 복사 | ESI가 가리키는 메모리 값을 EDI가 가리키는 메모리로 복사한다. 두 레지스터는 자동으로 증가하거나 감소한다.              |
| CMPSB/W/D | 메모리 비교 | ESI와 EDI가 가리키는 메모리 피연산자들을 비교한다. REPE와 함께 사용하면 ECX가 0이 되거나 차이가 발생할 때까지 반복한다. |
| SCASB/W/D | 값 검색   | AL/AX/EAX의 값을 EDI가 가리키는 메모리 값과 비교한다.                                        |
| STOSB/W/D | 값 저장   | AL/AX/EAX의 값을 EDI가 가리키는 위치에 저장한다. 문자열의 각 바이트를 0FFh로 초기화할 때 사용한다.            |
| LODSB/W/D | 값 로드   | ESI가 가리키는 메모리의 바이트 또는 워드를 AL/AX/EAX로 로드한다.                                  |

## 방향 제어

ESI와 EDI의 자동 증가/감소는 CPU의 Direction Flag에 의해 제어된다. **CLD**와 **STD** 명령어를 사용하여 방향 플래그를 설정하거나 해제한다.

---

# 선택된 문자열 프로시저 (Irvine32 라이브러리)

Irvine32 라이브러리는 널 종료(null-terminated) 문자열을 조작하는 여러 프로시저를 제공한다.

## Str_length

문자열의 오프셋을 전달하면 EAX 레지스터에 문자열 길이를 반환한다.

## Str_copy

널 종료 문자열을 원본 위치에서 대상 위치로 복사한다. 호출 전에 대상 공간이 충분히 확보되어 있어야 한다.

## Str_trim

널 종료 문자열에서 선택된 **후행 문자(trailing character)**의 모든 발생을 제거한다. 문자열 끝에서 역방향으로 스캔해 첫 번째 비분리 문자를 찾은 뒤, 그 문자 뒤에 널 바이트를 삽입한다.

## Str_ucase

문자열의 모든 문자를 대문자로 변환한다. 반환 값은 없다.

## Str_compare

두 문자열을 비교한다. 비교는 첫 번째 바이트부터 시작하며, 대소문자를 구분한다. 결과는 Carry 및 Zero 플래그를 통해 해석한다.

---

# 2차원 배열

2차원 배열에 접근할 때는 주소 지정 방식이 중요하다.

## 베이스-인덱스 피연산자 (Base-Index Operand)

두 레지스터(베이스와 인덱스)를 더하여 오프셋 주소를 생성한다. 행 우선(row-major order) 배열에서 행 오프셋은 베이스 레지스터, 열 오프셋은 인덱스 레지스터에 저장한다.

## 베이스-인덱스-변위 피연산자 (Base-Index-Displacement Operand)

변위(변수 이름 또는 상수), 베이스 레지스터, 인덱스 레지스터, **선택적 스케일 팩터(scale factor)**를 조합하여 유효 주소를 생성한다. WORD 배열을 처리할 경우, 인덱스 레지스터에 2의 스케일 팩터를 적용해야 한다.

## calc_row_sum 프로시저

바이트 행렬에서 특정 행의 합계를 계산한다. EBX(테이블 시작 주소), EAX(행 번호), ECX(행 크기)를 입력받아 합계를 EAX로 반환한다.

---

# 정수 배열 검색 및 정렬

정수 배열을 조작할 때 다음 알고리즘을 사용한다.

## A. 버블 정렬 (BubbleSort)

### 기능

32비트 부호 있는 정수 배열을 오름차순으로 정렬한다.

### 원리

배열의 앞에서부터 두 값을 비교하여 역순이면 교환한다.

### 특징

* 한 번의 전체 순회만으로는 완전히 정렬되지 않을 수 있다.
* 가장 큰 값은 마지막 위치로 이동한다.
* 배열은 총 `n - 1`번의 순회 후 정렬됨이 보장된다.

## B. 이진 검색 (BinarySearch)

### 기능

정렬된 부호 정수 배열에서 특정 값을 검색한다.

### 원리 및 단계

1. **first ≤ last** 조건이 유지되는 동안 반복한다. 조건이 깨지면 검색 실패이며 -1을 반환한다.
2. first와 last의 중간 지점(mid)을 계산한다.
3. searchVal과 mid 위치 원소를 비교한다.
4. 값이 같으면 mid를 반환한다.
5. searchVal > mid 값이면 `first ← mid + 1`.
6. searchVal < mid 값이면 `last ← mid - 1`.

### 반환값

* 찾으면 위치(mid)를 **EAX**에 반환
* 찾지 못하면 **EAX = -1** 반환
